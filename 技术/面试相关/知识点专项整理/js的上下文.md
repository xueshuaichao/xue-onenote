 # 执行上下文(Excution Context)

执行上下文是指 Javascript 代码被执行时所在的环境



 ## “执行上下文”的类型
准确来说，“执行上下文”有三种类型，分别是:**“全局执行上下文"**、**“函数执行上下文"**、**“eval** 函数执行上下文”。但是由于 eval 函数使用的比较少，所以我们主要讨论其它两种。


__全局执行上下文__:默认的、最基础的执行上下文，不在任何函数中的代码都位于“全局执行上下文”中。一个程序中只能存在一个“全局执行上下文"。 它做了两件事:

- 创建一个全局对象，在浏览器中这个全局对象就是 window 对象
- 将 this 指向这个全局对象。

**函数执行上下文**:每次调用函数，都会为该函数创建一个新的执行上下文。

 ## 执行上下文的生命周期
一共有三个阶段:创建阶段、入栈执行阶段、出栈回收阶段

 ## 执行栈
也叫调用栈，是用来存储"执行上下文”的一种先入后出的结构。入栈和出栈对应的是内存的申请和释放。  

当 Javascript 代码运行的时候，会首先创建一个“全局执行上下文”，并压入到当前执行栈中。之后当发生函数调用的时候，Js 引擎会为该函数创建一个“函数执行上下文"并压入到栈顶。当该函数执行完成后，其对应的“执行上下文"会被移出当前执行栈。调用栈中最上面的那个“执行上下文"一直是处于正在执行状态。


 ## 执行上下文的结构
如果我们使用伪代码模拟一下它的结构的的话，大致是这样的:

也就是代码执行前那个阶段，创建了执行上下文，主要办3件事:
1. 创建变量对象(variable object,vo)
2. 创建作用域链(scope chain)
3. 确定 this 值

 ## 全局执行上下文全生命周期基本流程(重要)
1. 创建一个全局执行上下文
2. 分析变量声明和函数声明(通过 function关键字声明的函数)，将声明的变量和函数挂到变量对象上
   - 函数声明优先级高于变量声明，同名的话，函数会覆盖变量
   - 由于还未进入执行期，所以声明的变量的值都为undefined
   - 这个步骤在有些地方被称为:变量和函数声明提前
3. 将执行上下文压入到执行栈中，执行具体代码
4. 除非关闭浏览器，否则全局执行上下文一直不出栈

 # 三，作用域链
作用域链：内部函数访问外部函数的变量，采取的是链式查找的方式来决定取哪个值，这种结构我们称为作用域链：

采用就近原则，内部函数访问外部函数，从内向外访问，没有的话就继续往上找即可：


